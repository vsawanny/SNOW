<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Change Request">03b753f8db5a7300254285184b96196f</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"392fc8a8a6dd48f6a400c9ff10a695ae","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":""},"id":"392fc8a8a6dd48f6a400c9ff10a695ae"}],"goals":[{"name":"Catalog Item Search","trigger_id":"392fc8a8a6dd48f6a400c9ff10a695ae","nodes":[{"type":"StartGoal","goal_id":"95f910ca92a74750bf995521587e0d75","greeting_msg":{"type":"String","mode":"string","value":""},"id":"57817db588844f598b0e547faeecfdb1","name":"Start"},{"type":"TerminateGoal","goal_id":"95f910ca92a74750bf995521587e0d75","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"bdf3f88cc1014778ae20a708302fce87","name":"End"},{"type":"CarouselInputPrompt","carousel_options_script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    var options = [];\n    for (var i=0; i&lt; results.length; i++) {\n        options.push(\n            {\n                'Name': results[i].title,\n                'Value': i + '',\n                'Body': baseURL + '/' + results[i].image\n            }\n        );\n    }\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"gs.getMessage(\"No Records Found\")"},"id":"8e51c32f48fe44f3aaea33ba27fa1e3d","name":"Catalog Item","goal_id":"95f910ca92a74750bf995521587e0d75","variable_id":"067869efee81479faae1d657f8e1ad18","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Here’s what I have available.  You'll have a chance to confirm or cancel the order next.\")"},"optional":false},{"type":"InputPrompt","variable_id":"729ad97fc93548768a06d71877babb38","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter a short description of what you're looking for.\")"},"optional":false,"id":"974f83f8df2741acab3e365a3002703b","name":"Search Term","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"ScriptedAction","script":"(function execute() {\n    var search_term = vaInputs.search_term;\n    var context = '6f7e3f565b30130070e4492c11f91aea';\n\n    var contextualSearch = new sn_itsm_va.VAContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        vaVars.count = 0;\n        return '';\n    }\n\n    //Filter out any catalog items that should not be shown ie. Record Producers\n    //create a filterMap to quickly see if item can be shown to user\n    var filter_tables = vaVars.filter_tables.split(',');\n    var filterMap = {};\n    for (var i=0; i &lt; filter_tables.length; i++) {\n        filterMap[filter_tables[i]] = 'true';\n    }\n\n    var searchResults = response.results;\n    var results = [];\n    var count = 0;\n    for (var index=0; index &lt; searchResults.length &amp;&amp; count &lt; parseInt(vaVars.limit); index++) {\n        //Get sys_id of search result\n        var sys_id = searchResults[index].id.split(':')[1];\n        //Lookup item to find the tableName\n        var gr = new GlideRecord('sc_cat_item');\n        if (gr.get(sys_id)) {\n            var tableName = gr.getValue('sys_class_name');\n            //if the tableName is not found in filterMap, we can show it to user\n            if (filterMap[tableName] == undefined) {\n                results.push({\n                    'sys_id': sys_id,\n                    'title': searchResults[index].title,\n                    'image': searchResults[index].image.link\n                });\n                count++;\n            }\n        }\n    }\n\n    vaVars.count = results.length;\n    vaVars.results = JSON.stringify(results);\n\n    return '';\n})()\n","id":"50c4525a298848cf994400ed7453089c","name":"Contextual Search","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"More than One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) &gt; 1;\n})()\n"},"id":"95d39c24b60446169b3ff31498bdaa37","name":"More than One Item"},{"type":"Branch","label":"Only One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 1;\n})()\n"},"id":"2a25751cf1134c3fba04145d368df8f8","name":"Only One Item"},{"type":"Branch","label":"No Items Exist","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 0;\n})()\n"},"id":"f3ab4a91db884885be36782ccceeb9a1","name":"No Items Exist"}],"id":"4474a1e0effe4bac884813ba6257fb09","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Try Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.search_again.getValue();\n})()\n"},"id":"2a484d11b6e24bc5a6ea8cd0a482425a","name":"Try Again"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.search_again.getValue();\n})()\n"},"id":"2b9405720ef4475c903139c8ef60c044","name":"Cancel"}],"id":"322c2b29aa9e40a99dcb01a11a56aa8a","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"ImageOutputPrompt","url":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    return baseURL + '/' + results[0].image;\n})()\n"},"id":"e4b74ffdb76146a6bc8f1aa3e4556604","name":"Item Image","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"ScriptedAction","script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var index = 0;\n    if (parseInt(vaVars.count) &gt; 1) {\n        index = parseInt(vaInputs.catalog_item);\n    }\n    vaVars.selected_title = results[index].title;\n    vaVars.selected_link = gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') + \n        '?id=sc_cat_item&amp;sys_id=' + results[index].sys_id;\n    return '';\n})()\n","id":"384725b57d104110a6489a9f5f30dbfa","name":"Set Selected Item","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Image Exists","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image != '');\n})()\n"},"id":"e278a023ea7645a59c12687282410791","name":"Image Exists"},{"type":"Branch","label":"No Image","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image == '');\n})()\n"},"id":"52cb3495842546e88b6cd4ccce324b3d","name":"No Image"}],"id":"860b3d7f06614866baf0fd57ea9196e3","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, but I couldn’t find any relevant items.\")"},"id":"d17a9909560a41a6ad59f75e98056c67","name":"No Items Found","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"InputPrompt","variable_id":"d6529ea3004148a09861aff92e30bea9","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Would you like to search for something else?\")"},"optional":false,"id":"410846c929ea430ab624f5cca1eea6b7","name":"Search Again","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    if (parseInt(vaVars.count) == 1)\n        return gs.getMessage('The only item I found is {0}.', vaVars.selected_title);\n\n    return question = gs.getMessage('OK, you chose {0}.', vaVars.selected_title);\n})()\n"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Create your Change Here .\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    return gs.getProperty('glide.servlet.uri') + '/' + vaVars.selected_link;\n})()\n"},"id":"57e68416cb4a43acaac02ab550e944e9","name":"Link Output","goal_id":"95f910ca92a74750bf995521587e0d75"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"4a5dda201e094caba1421bba1f081619","name":"Acknowledgement","goal_id":"95f910ca92a74750bf995521587e0d75"}],"edges":[{"type":"Edge","source_node_id":"d17a9909560a41a6ad59f75e98056c67","target_node_id":"410846c929ea430ab624f5cca1eea6b7","id":"1a8800865bb447ff9124ff64bd672d67"},{"type":"Edge","source_node_id":"322c2b29aa9e40a99dcb01a11a56aa8a","target_node_id":"974f83f8df2741acab3e365a3002703b","branch_id":"2a484d11b6e24bc5a6ea8cd0a482425a","id":"faf84bf0ac534d29b8d4240da74dafd6","name":"2a484d11b6e24bc5a6ea8cd0a482425a"},{"type":"Edge","source_node_id":"8e51c32f48fe44f3aaea33ba27fa1e3d","target_node_id":"384725b57d104110a6489a9f5f30dbfa","id":"3861e2ac612c4eb7904c8d9c8f8978ca"},{"type":"Edge","source_node_id":"57817db588844f598b0e547faeecfdb1","target_node_id":"974f83f8df2741acab3e365a3002703b","id":"5e3ef06537e144fa8c212f6b7333b959"},{"type":"Edge","source_node_id":"974f83f8df2741acab3e365a3002703b","target_node_id":"50c4525a298848cf994400ed7453089c","id":"dd34744b76ac46c2891c2ffca2b154e1"},{"type":"Edge","source_node_id":"50c4525a298848cf994400ed7453089c","target_node_id":"4474a1e0effe4bac884813ba6257fb09","id":"041090da2eb94fa3940b9651fe6ec4a9"},{"type":"Edge","source_node_id":"4474a1e0effe4bac884813ba6257fb09","target_node_id":"8e51c32f48fe44f3aaea33ba27fa1e3d","branch_id":"95d39c24b60446169b3ff31498bdaa37","id":"5e55368be770459b82aabce46cf716f0","name":"95d39c24b60446169b3ff31498bdaa37"},{"type":"Edge","source_node_id":"e4b74ffdb76146a6bc8f1aa3e4556604","target_node_id":"384725b57d104110a6489a9f5f30dbfa","id":"c7ce978803c749a5bfc93d9c047072ba"},{"type":"Edge","source_node_id":"4474a1e0effe4bac884813ba6257fb09","target_node_id":"860b3d7f06614866baf0fd57ea9196e3","branch_id":"2a25751cf1134c3fba04145d368df8f8","id":"b7b609f99a834ef08e604f2491093bc9","name":"2a25751cf1134c3fba04145d368df8f8"},{"type":"Edge","source_node_id":"860b3d7f06614866baf0fd57ea9196e3","target_node_id":"e4b74ffdb76146a6bc8f1aa3e4556604","branch_id":"e278a023ea7645a59c12687282410791","id":"3da931fe6b4341739b2302488e0c3321","name":"e278a023ea7645a59c12687282410791"},{"type":"Edge","source_node_id":"860b3d7f06614866baf0fd57ea9196e3","target_node_id":"384725b57d104110a6489a9f5f30dbfa","branch_id":"52cb3495842546e88b6cd4ccce324b3d","id":"804f9e1d0df84f8b89544e94082a4e7e","name":"52cb3495842546e88b6cd4ccce324b3d"},{"type":"Edge","source_node_id":"4474a1e0effe4bac884813ba6257fb09","target_node_id":"d17a9909560a41a6ad59f75e98056c67","branch_id":"f3ab4a91db884885be36782ccceeb9a1","id":"e04249f7872e4744ad3e2f1f1a8d6755","name":"f3ab4a91db884885be36782ccceeb9a1"},{"type":"Edge","source_node_id":"410846c929ea430ab624f5cca1eea6b7","target_node_id":"322c2b29aa9e40a99dcb01a11a56aa8a","id":"c16973a0b2144b6a8eca6d79113ff864"},{"type":"Edge","source_node_id":"384725b57d104110a6489a9f5f30dbfa","target_node_id":"57e68416cb4a43acaac02ab550e944e9","id":"e7c2df5b24c44465b38299ab67024132"},{"type":"Edge","source_node_id":"57e68416cb4a43acaac02ab550e944e9","target_node_id":"410846c929ea430ab624f5cca1eea6b7","id":"47abb60dbe7a4547843893c69416570a"},{"type":"Edge","source_node_id":"322c2b29aa9e40a99dcb01a11a56aa8a","target_node_id":"4a5dda201e094caba1421bba1f081619","branch_id":"2b9405720ef4475c903139c8ef60c044","id":"488b5170f89f48f8848847982f174090","name":"2b9405720ef4475c903139c8ef60c044"},{"type":"Edge","source_node_id":"4a5dda201e094caba1421bba1f081619","target_node_id":"bdf3f88cc1014778ae20a708302fce87","id":"d5c5c4d6113145d28063cdee89b5babd"}],"id":"95f910ca92a74750bf995521587e0d75"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"5"},"id":"19ecfa65e36c4672bb444e9aa550b98f"},{"type":"String","name":"count","value":{"type":"String","mode":"string","value":"0"},"id":"0b91c27a366b4f4998310574a9594118"},{"type":"String","name":"results","id":"1c175868e6064cc9a82d83caa3d779f1"},{"type":"String","name":"selected_title","id":"498ba615fc9f4053a667aca120ad730f"},{"type":"String","name":"selected_link","id":"5d17e42d318944b9b7ae951ae2d2940f"},{"type":"String","name":"filter_tables","value":{"type":"String","mode":"string","value":"sc_cat_item_content,sc_cat_item_producer,sc_cat_item_wizard,std_change_record_producer,sc_cat_item_producer_service"},"id":"b8a2f5fa9bd14c20967c97c31e0668f1"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"8b0d6e61f779490b95122c79fbbd8d15"}],"glide_variables":[{"type":"CarouselImage","id":"067869efee81479faae1d657f8e1ad18","name":"catalog_item"},{"type":"String","name":"search_term","id":"729ad97fc93548768a06d71877babb38"},{"type":"True/False","id":"d6529ea3004148a09861aff92e30bea9","name":"search_again"}],"applicability":{"type":"Applicability","mode":"script","value":""},"roles":[],"scope":"e18088d2db203300254285184b9619b5","id":"0eb7db3cdb5a7300254285184b961928","name":"Change Request","key_phrases":["request","buy","item","catalog","purchase","order","computer","phone","need","require"]}</design_definition>
        <design_topic_id>0eb7db3cdb5a7300254285184b961928</design_topic_id>
        <name>Change Request</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-06-25 10:46:36</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>4bb7db3cdb5a7300254285184b961970</sys_id>
        <sys_mod_count>5</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="appTest" source="x_181622_apptest">e18088d2db203300254285184b9619b5</sys_package>
        <sys_policy/>
        <sys_scope display_value="appTest">e18088d2db203300254285184b9619b5</sys_scope>
        <sys_update_name>sys_cb_design_topic_4bb7db3cdb5a7300254285184b961970</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-06-25 10:55:24</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
