<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Order HCL Item">6bcec770db5a7300254285184b9619a6</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"da422deb66d84c5f883d2fa1bff5518d","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":""},"id":"da422deb66d84c5f883d2fa1bff5518d"}],"goals":[{"name":"Catalog Item Search","trigger_id":"da422deb66d84c5f883d2fa1bff5518d","nodes":[{"type":"StartGoal","goal_id":"972516638cea4bd48e0ac089b757b5ac","greeting_msg":{"type":"String","mode":"string","value":""},"id":"af2b79291d7e4e3199ed0a7597d7976d","name":"Start"},{"type":"TerminateGoal","goal_id":"972516638cea4bd48e0ac089b757b5ac","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"3d0b315026b646668eee4940e703ff60","name":"End"},{"type":"CarouselInputPrompt","carousel_options_script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    var options = [];\n    for (var i=0; i&lt; results.length; i++) {\n        options.push(\n            {\n                'Name': results[i].title,\n                'Value': i + '',\n                'Body': baseURL + '/' + results[i].image\n            }\n        );\n    }\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"gs.getMessage(\"No Records Found\")"},"id":"c3bdf8ed749f4d12ba5223b1c7edb893","name":"Catalog Item","goal_id":"972516638cea4bd48e0ac089b757b5ac","variable_id":"a069943457c7489db1f78b89a61aa86b","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Here’s what I have available.  You'll have a chance to confirm or cancel the order next.\")"},"optional":false},{"type":"InputPrompt","variable_id":"0932e11b9a1943a3928623e096f2e137","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter a short description of what you're looking for.\")"},"optional":false,"id":"11c60dbd9c22416f9a40b05ea67836f3","name":"Search Term","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"ScriptedAction","script":"(function execute() {\n    var search_term = vaInputs.search_term;\n    var context = '6f7e3f565b30130070e4492c11f91aea';\n\n    var contextualSearch = new sn_itsm_va.VAContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        vaVars.count = 0;\n        return '';\n    }\n\n    //Filter out any catalog items that should not be shown ie. Record Producers\n    //create a filterMap to quickly see if item can be shown to user\n    var filter_tables = vaVars.filter_tables.split(',');\n    var filterMap = {};\n    for (var i=0; i &lt; filter_tables.length; i++) {\n        filterMap[filter_tables[i]] = 'true';\n    }\n\n    var searchResults = response.results;\n    var results = [];\n    var count = 0;\n    for (var index=0; index &lt; searchResults.length &amp;&amp; count &lt; parseInt(vaVars.limit); index++) {\n        //Get sys_id of search result\n        var sys_id = searchResults[index].id.split(':')[1];\n        //Lookup item to find the tableName\n        var gr = new GlideRecord('sc_cat_item');\n        if (gr.get(sys_id)) {\n            var tableName = gr.getValue('sys_class_name');\n            //if the tableName is not found in filterMap, we can show it to user\n            if (filterMap[tableName] == undefined) {\n                results.push({\n                    'sys_id': sys_id,\n                    'title': searchResults[index].title,\n                    'image': searchResults[index].image.link\n                });\n                count++;\n            }\n        }\n    }\n\n    vaVars.count = results.length;\n    vaVars.results = JSON.stringify(results);\n\n    return '';\n})()\n","id":"f61430f846ee4be5a7cd5485789a7be1","name":"Contextual Search","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"More than One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) &gt; 1;\n})()\n"},"id":"ddc7023c54b444398830d7b25e62a88d","name":"More than One Item"},{"type":"Branch","label":"Only One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 1;\n})()\n"},"id":"3813e9278b544cd88fd6b48c0a48c9ed","name":"Only One Item"},{"type":"Branch","label":"No Items Exist","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 0;\n})()\n"},"id":"1c60bc9cf71341478e7c7dd04c6cea0e","name":"No Items Exist"}],"id":"9a4e11efa7984f63b0b0a0b7b5bb4071","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Try Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.search_again.getValue();\n})()\n"},"id":"4fec33f7984240caaeb4384f8d8c77c0","name":"Try Again"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.search_again.getValue();\n})()\n"},"id":"c8624a3646504ddd8c03ea436b962121","name":"Cancel"}],"id":"d06f521b3a3b46a5a47cb5c4b54dd117","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"ImageOutputPrompt","url":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    return baseURL + '/' + results[0].image;\n})()\n"},"id":"2ba0e4e7081041249c1daa62a34389f7","name":"Item Image","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"ScriptedAction","script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var index = 0;\n    if (parseInt(vaVars.count) &gt; 1) {\n        index = parseInt(vaInputs.catalog_item);\n    }\n    vaVars.selected_title = results[index].title;\n    vaVars.selected_link = gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') + \n        '?id=sc_cat_item&amp;sys_id=' + results[index].sys_id;\n    return '';\n})()\n","id":"51aa203022eb44b38a403f33c2d1a9b4","name":"Set Selected Item","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Image Exists","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image != '');\n})()\n"},"id":"807939ce98d14511a4b4ff1a775c288f","name":"Image Exists"},{"type":"Branch","label":"No Image","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image == '');\n})()\n"},"id":"da830ea44f8b4a65b8d474710f59d3bc","name":"No Image"}],"id":"302f11f68458474f9812b4d8ef24ff54","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, but I couldn’t find any relevant items.\")"},"id":"618400476c10416daa078c2093271179","name":"No Items Found","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"InputPrompt","variable_id":"480bdf3467664dd8b645b5fd42e25e07","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Would you like to search for something else?\")"},"optional":false,"id":"4589faeb7ea84c8eb4560ace147cfb24","name":"Search Again","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    if (parseInt(vaVars.count) == 1)\n        return gs.getMessage('The only item I found is {0}.', vaVars.selected_title);\n\n    return question = gs.getMessage('OK, you chose {0}.', vaVars.selected_title);\n})()\n"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Create your Change Here .\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    return gs.getProperty('glide.servlet.uri') + '/' + vaVars.selected_link;\n})()\n"},"id":"6305cb6bb55b49328be00d80777b6e30","name":"Link Output","goal_id":"972516638cea4bd48e0ac089b757b5ac"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"bfb3e6976cce4d3d8f28c41baf172329","name":"Acknowledgement","goal_id":"972516638cea4bd48e0ac089b757b5ac"}],"edges":[{"type":"Edge","source_node_id":"618400476c10416daa078c2093271179","target_node_id":"4589faeb7ea84c8eb4560ace147cfb24","id":"73a588db123843e7a66e62133a829da6"},{"type":"Edge","source_node_id":"d06f521b3a3b46a5a47cb5c4b54dd117","target_node_id":"11c60dbd9c22416f9a40b05ea67836f3","branch_id":"4fec33f7984240caaeb4384f8d8c77c0","id":"42efccc1a74d4589b9502abaf67efa32","name":"4fec33f7984240caaeb4384f8d8c77c0"},{"type":"Edge","source_node_id":"c3bdf8ed749f4d12ba5223b1c7edb893","target_node_id":"51aa203022eb44b38a403f33c2d1a9b4","id":"964c42d569cf479e9a3d7c269af88abd"},{"type":"Edge","source_node_id":"af2b79291d7e4e3199ed0a7597d7976d","target_node_id":"11c60dbd9c22416f9a40b05ea67836f3","id":"1fe20034f3ad4666bd9640470b1caede"},{"type":"Edge","source_node_id":"11c60dbd9c22416f9a40b05ea67836f3","target_node_id":"f61430f846ee4be5a7cd5485789a7be1","id":"8b9e5f2182c941a294dc7f21ff5a4bda"},{"type":"Edge","source_node_id":"f61430f846ee4be5a7cd5485789a7be1","target_node_id":"9a4e11efa7984f63b0b0a0b7b5bb4071","id":"83e1fbc6a5b0487481b90690ec1de418"},{"type":"Edge","source_node_id":"9a4e11efa7984f63b0b0a0b7b5bb4071","target_node_id":"c3bdf8ed749f4d12ba5223b1c7edb893","branch_id":"ddc7023c54b444398830d7b25e62a88d","id":"a5c39f90adb64c7d817ca3aa5da6fc5a","name":"ddc7023c54b444398830d7b25e62a88d"},{"type":"Edge","source_node_id":"2ba0e4e7081041249c1daa62a34389f7","target_node_id":"51aa203022eb44b38a403f33c2d1a9b4","id":"467585e6c2ec442a9a7d545d02f41590"},{"type":"Edge","source_node_id":"9a4e11efa7984f63b0b0a0b7b5bb4071","target_node_id":"302f11f68458474f9812b4d8ef24ff54","branch_id":"3813e9278b544cd88fd6b48c0a48c9ed","id":"b86b4b5f79ff494785b22bf75747f0ef","name":"3813e9278b544cd88fd6b48c0a48c9ed"},{"type":"Edge","source_node_id":"302f11f68458474f9812b4d8ef24ff54","target_node_id":"2ba0e4e7081041249c1daa62a34389f7","branch_id":"807939ce98d14511a4b4ff1a775c288f","id":"cc3389a38ba649aa8d2bdac607961458","name":"807939ce98d14511a4b4ff1a775c288f"},{"type":"Edge","source_node_id":"302f11f68458474f9812b4d8ef24ff54","target_node_id":"51aa203022eb44b38a403f33c2d1a9b4","branch_id":"da830ea44f8b4a65b8d474710f59d3bc","id":"98a6cc53b12d4944ac431a7e7b0595e4","name":"da830ea44f8b4a65b8d474710f59d3bc"},{"type":"Edge","source_node_id":"9a4e11efa7984f63b0b0a0b7b5bb4071","target_node_id":"618400476c10416daa078c2093271179","branch_id":"1c60bc9cf71341478e7c7dd04c6cea0e","id":"80a48efa986742868f6c1123b3f6366d","name":"1c60bc9cf71341478e7c7dd04c6cea0e"},{"type":"Edge","source_node_id":"4589faeb7ea84c8eb4560ace147cfb24","target_node_id":"d06f521b3a3b46a5a47cb5c4b54dd117","id":"f560a7052b3b42958856ace87948cf76"},{"type":"Edge","source_node_id":"51aa203022eb44b38a403f33c2d1a9b4","target_node_id":"6305cb6bb55b49328be00d80777b6e30","id":"a1cf5ee749aa4444a247dd22a21f28a2"},{"type":"Edge","source_node_id":"6305cb6bb55b49328be00d80777b6e30","target_node_id":"4589faeb7ea84c8eb4560ace147cfb24","id":"be0551567a2d4e539d89c4ea546572e1"},{"type":"Edge","source_node_id":"d06f521b3a3b46a5a47cb5c4b54dd117","target_node_id":"bfb3e6976cce4d3d8f28c41baf172329","branch_id":"c8624a3646504ddd8c03ea436b962121","id":"5c5221f2d3734ff392e66e8a08df13cb","name":"c8624a3646504ddd8c03ea436b962121"},{"type":"Edge","source_node_id":"bfb3e6976cce4d3d8f28c41baf172329","target_node_id":"3d0b315026b646668eee4940e703ff60","id":"5efd8c9b19104167bb9334967692fd91"}],"id":"972516638cea4bd48e0ac089b757b5ac"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"5"},"id":"64485cf493034c399d4d82b5a6530597"},{"type":"String","name":"count","value":{"type":"String","mode":"string","value":"0"},"id":"ec7277d5e19c47d596b739393fd82f6c"},{"type":"String","name":"results","id":"998226d03b484eb18e03844494714741"},{"type":"String","name":"selected_title","id":"1df377d1a7744644a4c64818672e1c35"},{"type":"String","name":"selected_link","id":"682dc53a101146edae54bc6cbd2a5b11"},{"type":"String","name":"filter_tables","value":{"type":"String","mode":"string","value":"sc_cat_item_content,sc_cat_item_producer,sc_cat_item_wizard,std_change_record_producer,sc_cat_item_producer_service"},"id":"dc44bde7d6e64a7790a48cd6f25d4516"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"95769c885de74002ab2016f3637dc990"}],"glide_variables":[{"type":"CarouselImage","id":"a069943457c7489db1f78b89a61aa86b","name":"catalog_item"},{"type":"String","name":"search_term","id":"0932e11b9a1943a3928623e096f2e137"},{"type":"True/False","id":"480bdf3467664dd8b645b5fd42e25e07","name":"search_again"}],"applicability":{"type":"Applicability","mode":"script","value":""},"roles":[],"scope":"e18088d2db203300254285184b9619b5","id":"7eae4f70db5a7300254285184b9619d7","name":"Order HCL Item","key_phrases":["request","buy","item","catalog","purchase","order","computer","phone","need","require"]}</design_definition>
        <design_topic_id>7eae4f70db5a7300254285184b9619d7</design_topic_id>
        <name>Order HCL Item</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-06-25 10:07:35</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>e7cec770db5a7300254285184b9619a9</sys_id>
        <sys_mod_count>2</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="appTest" source="x_181622_apptest">e18088d2db203300254285184b9619b5</sys_package>
        <sys_policy/>
        <sys_scope display_value="appTest">e18088d2db203300254285184b9619b5</sys_scope>
        <sys_update_name>sys_cb_design_topic_e7cec770db5a7300254285184b9619a9</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-06-25 10:08:12</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
